<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Streamer</title>
</head>
<body>
    <h1>Video Streamer</h1>
    
    <label for="videoUrl">Enter YouTube Video URL:</label>
    <input type="text" id="videoUrl" placeholder="Enter YouTube Video URL">
    
    <button id="startBtn">Start Streaming</button>
    <button id="stopBtn" disabled>Stop Streaming</button>
    
    <video id="videoPlayer" controls></video>
    
    <script>
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const videoUrlInput = document.getElementById('videoUrl');
        const videoPlayer = document.getElementById('videoPlayer');

        const backendUrl = "https://developerstream.onrender.com";  // Replace with your backend URL

        // Function to get cookies from the browser
        function getCookies() {
            // For simplicity, we assume you have cookies in the document
            return document.cookie;  // You might need a different method depending on how cookies are handled in your app
        }

        startBtn.addEventListener('click', async () => {
            const videoUrl = videoUrlInput.value;
            const cookies = getCookies();  // Get cookies from the browser

            if (!videoUrl) {
                alert("Please enter a video URL!");
                return;
            }

            try {
                const response = await fetch(`${backendUrl}/start-streaming`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ 
                        video_url: videoUrl, 
                        cookies: cookies  // Send cookies for YouTube authentication
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    alert("Video ready for streaming!");
                    stopBtn.disabled = false;  // Enable stop button
                    videoPlayer.src = `${backendUrl}/video`;
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                console.error("Error:", error);
                alert("An error occurred while starting the stream.");
            }
        });

        stopBtn.addEventListener('click', async () => {
            try {
                const response = await fetch(`${backendUrl}/stop-streaming`, {
                    method: 'POST',
                });

                const data = await response.json();

                if (response.ok) {
                    alert("Streaming stopped.");
                    stopBtn.disabled = true;  // Disable stop button
                    videoPlayer.src = "";  // Clear video source
                } else {
                    alert(`Error: ${data.error}`);
                }
            } catch (error) {
                console.error("Error:", error);
                alert("An error occurred while stopping the stream.");
            }
        });
    </script>
</body>
</html>
